{% embed "@RoadizRozier/macros/rz_actions_menu.html.twig" with {
    vertical: true,
    class: 'actions-menu',
    node: node,
    source: source,
    translation: translation,
    versions: versions,
    currentVersion: currentVersion,
    loop: loop,
    max_versions_showed: max_versions_showed,
    readOnly: readOnly,
} only %}
    {% block items %}
    {% if node %}
        {% import '@RoadizRozier/macros/rz_button.html.twig' as rz_button %}
        {% set canPublish = workflow_can(node, 'publish') %}
        {% if not node.isDeleted %}
            <rz-popover
                popover-placement="left-start"
                popover-offset="18px"
                >
                    {{ rz_button.root({
                        icon: 'rz-icon-ri--settings-4-line',
                        emphasis: 'tertiary',
                        onDark: true,
                        attributes: {
                            title: 'actions'|trans,
                            popovertarget: 'action-menu',
                            'popover-placement': 'left',
                        }
                    }) }}
                {% embed "@RoadizRozier/macros/rz_dropdown_menu.html.twig" with {
                    title: 'actions',
                    reverse: true,
                    targetId: 'action-menu'
                } %}
                    {% block items %}
                        {% if source and source.Reachable %}
                            {% if node.published %}
                                {{ _self.item({
                                    label: 'see.page',
                                    href: path('nodesSourcesPublicRedirect', {
                                        'nodeSourceId': source.id,
                                    }),
                                    leftIcon: 'rz-icon-ri--eye-line',
                                    rightIcon: 'rz-icon-ri--arrow-right-s-line',
                                }) }}
                            {% endif %}
                            {% if node.published or node.draft or node.pending %}
                                {{ _self.item({
                                    label: 'preview.page',
                                    href: path('nodesSourcesPreviewRedirect', {
                                        'nodeSourceId': source.id,
                                    }),
                                    leftIcon: 'rz-icon-ri--eye-line',
                                    rightIcon: 'rz-icon-ri--arrow-right-s-line',
                                }) }}
                            {% endif %}
                        {% endif %}
                        {% if not node.isLocked %}
                            {% if is_granted('DUPLICATE', node) %}
                                {{ _self.item({
                                    label: 'duplicate',
                                    href: path('nodesDuplicatePage', { nodeId: node.getId }),
                                    leftIcon: 'rz-icon-ri--file-copy-2-line',
                                    rightIcon: 'rz-icon-ri--arrow-right-s-line',
                                }) }}
                            {% endif %}
                            {% if is_granted('EDIT_SETTING', node) %}
                                {{ _self.item({
                                    label: 'transtype',
                                    href: path('nodesTranstypePage', { nodeId: node.getId }),
                                    leftIcon: 'rz-icon-ri--command-line',
                                    rightIcon: 'rz-icon-ri--arrow-right-s-line',
                                }) }}
                            {% endif %}
                            {% if canPublish %}
                                {{ _self.item({
                                    label: 'publish_node_offspring',
                                    href: path('nodesPublishAllAction', { nodeId: node.getId }),
                                    leftIcon: 'rz-icon-ri--checkbox-line',
                                    rightIcon: 'rz-icon-ri--arrow-right-s-line',
                                }) }}
                            {% endif %}
                        {% endif %}
                        {{ _self.item({
                            label: 'add.child',
                            href: path('nodesAddChildPage', { nodeId: node.getId }),
                            leftIcon: 'rz-icon-ri--add-line',
                            rightIcon: 'rz-icon-ri--arrow-right-s-line',
                        }) }}
                        {% if node.hidingChildren and translation %}
                            {{ _self.item({
                                label: 'export_format.csv.%language%'|trans({'%language%':translation.name }),
                                href: path('nodesExportNodeCsvPage', {parentNodeId: node.id, translationId:translation.id}),
                                leftIcon: 'rz-icon-ri--file-pdf-2-line',
                                rightIcon: 'rz-icon-ri--arrow-right-s-line',
                            }) }}
                        {% endif %}
                    {% endblock %}
                    {% block additional_menu %}
                        <menu class="rz-dropdown__list node-statuses node-actions">
                            {% if workflow_can(node, 'reject') or node.isDraft %}
                                {{ _self.item({
                                    label: 'draft',
                                    leftIcon: 'rz-icon-rz--status-draft-fill',
                                    rightIcon : (node.isDraft) ? 'rz-icon-ri--checkbox-circle-line' : 'rz-icon-ri--checkbox-blank-circle-line',
                                input: {
                                    type: 'radio',
                                    name: 'status',
                                    value: 'reject',
                                    attr: {'data-node-id': node.getId},
                                },
                                }) }}
                            {% endif %}
                            {% if workflow_can(node, 'unarchive') %}
                                {{ _self.item({
                                    label: 'draft',
                                    leftIcon: 'rz-icon-rz--status-draft-fill',
                                    rightIcon : (node.isDraft) ? 'rz-icon-ri--checkbox-circle-line' : 'rz-icon-ri--checkbox-blank-circle-line',
                                input: {
                                    type: 'radio',
                                    name: 'status',
                                    value: 'unarchive',
                                    attr: {'data-node-id': node.getId},
                                },
                                }) }}
                            {% endif %}
                            {% if workflow_can(node, 'review') or node.isPending %}
                                {{ _self.item({
                                    label: 'pending',
                                    leftIcon: 'rz-icon-rz--status-pending-fill',
                                    rightIcon : (node.isPending) ? 'rz-icon-ri--checkbox-circle-line' : 'rz-icon-ri--checkbox-blank-circle-line',
                                input: {
                                    type: 'radio',
                                    name: 'status',
                                    value: 'review',
                                    attr: {'data-node-id': node.getId},
                                },
                                }) }}
                            {% endif %}
                            {% if canPublish or node.isPublished %}
                                {{ _self.item({
                                    label: 'published',
                                    leftIcon: 'rz-icon-rz--status-published-fill',
                                    rightIcon : (node.isPublished) ? 'rz-icon-ri--checkbox-circle-line' : 'rz-icon-ri--checkbox-blank-circle-line',
                                    input: {
                                        type: 'radio',
                                        name: 'status',
                                        value: 'publish',
                                        attr: {'data-node-id': node.getId},
                                    },
                                }) }}
                            {% endif %}
                            {% if workflow_can(node, 'archive') or node.isArchived %}
                                {{ _self.item({
                                    label: 'archived',
                                    leftIcon: 'rz-icon-rz--status-archived-fill',
                                    rightIcon : (node.isArchived) ? 'rz-icon-ri--checkbox-circle-line' : 'rz-icon-ri--checkbox-blank-circle-line',
                                    input: {
                                        type: 'radio',
                                        name: 'status',
                                        value: 'archive',
                                        attr: {'data-node-id': node.getId},
                                    },
                                }) }}
                            {% endif %}
                        </menu>
                    {% endblock %}
                {% endembed %}
            </rz-popover>
        {% endif %}

        {% if versions and versions|length > 1 %}
            <rz-popover
                popover-placement="left-start"
                popover-offset="18px"
            >
                {{ rz_button.root({
                    icon: 'rz-icon-ri--git-fork-line',
                    emphasis: 'tertiary',
                    onDark: true,
                    attributes: {
                        title: 'versions'|trans,
                        popovertarget: 'version-menu',
                        'popover-placement': 'left',
                    }
                }) }}
                {% embed "@RoadizRozier/macros/rz_dropdown_menu.html.twig" with {
                    title: 'versions',
                    reverse: true,
                    targetId: 'version-menu'
                } %}
                    {% block items %}
                        {{ _self.item({
                            label: 'versions.working_copy',
                            href: path('nodesEditSourcePage', {
                                nodeId: node.id,
                                translationId: translation.id
                            }),
                            selected: not currentVersion,
                        }) }}
                        {% for version in versions %}
                            {% if loop.index0 > 0 and loop.index <= max_versions_showed %}
                                {{ _self.item({
                                    label: version.loggedAt|format_datetime('short', 'short', locale=app.request.locale),
                                    description: version.username,
                                    href: path('nodesEditSourcePage', {
                                        nodeId: node.id,
                                        translationId: translation.id,
                                        version: version.version
                                    }),
                                    selected: currentVersion and currentVersion.id == version.id,
                                }) }}
                            {% endif %}
                        {% endfor %}
                    {% endblock %}
                {% endembed %}
            </rz-popover>
        {% endif %}

        {% if not readOnly and is_granted('DELETE', node) %}
            {% set canDelete = workflow_can(node, 'delete') %}

            {% if workflow_can(node, 'undelete') %}
                {{ _self.item(
                    class: 'rz-button--primary rz-button--danger',
                    href: path('nodesUndeletePage', { nodeId: node.getId}),
                    icon: 'rz-icon-ri--device-recover-line',
                    attr: {
                        title: 'undelete'|trans,
                        'popover-placement': 'left',
                    }
                ) }}
            {% endif %}

            {% if canDelete and node.nodeSources|length > 1 and source %}
                {{ _self.item(
                    class: 'rz-button--primary rz-button--danger',
                    href: path('nodesDeleteSourcePage', { nodeSourceId: source.id }),
                    icon: 'rz-icon-ri--flag-off-line',
                    attr: {
                        title: 'delete.translation'|trans,
                        'popover-placement': 'left',
                    }
                ) }}
            {% endif %}

            {% if canDelete and (node.nodeSources|length == 1 or source.translation.defaultTranslation)  %}
                {{ _self.deleteItem(
                    href: path('nodesDeletePage', {
                        nodeId: node.getId,
                        referer: node.parent ? getBreadcrumbsItem(node.parent).url : null
                    }),
                    attr: {
                        title: 'delete.node'|trans,
                        'popover-placement': 'left',
                    },
                ) }}
            {% endif %}
        {% endif %}
    {% endif %}
    {% endblock %}
{% endembed %}
