{% import '@RoadizRozier/macros/rz_link.html.twig' as rz_link %}

{% if orderingParams is not defined %}
    {% if filters is not defined %}
        {% set orderingParams = {
            'item_per_page': 15,
            'page': 1,
        } %}
    {% else %}
        {% set orderingParams = app.request.query.all|merge({
            'item_per_page': filters.itemPerPage,
            'page': filters.currentPage,
        }) %}
        {% if filters.search %}
            {% set orderingParams = orderingParams|merge({
                'search': filters.search,
            }) %}
        {% endif %}
    {% endif %}
{% endif %}

{% set hasQuery = app.request.query.get("field") == field %}

{% if hasQuery and app.request.query.get("ordering") == "DESC" %}
    {% set localOrderingParams = orderingParams|merge({
        'field': field,
        'ordering': 'ASC'
    }) %}
    {{ rz_link.root({
            class: 'active ' ~ (column_ordering_class|default('')),
            label: label,
            icon: 'rz-icon-ri--arrow-down-s-fill',
            attributes: {
                href: '?' ~ localOrderingParams|url_encode,
                title: 'sort_asc'|trans,
            }
        })
    }}
{% elseif hasQuery and app.request.query.get("ordering") == "ASC" %}
    {% set localOrderingParams = orderingParams|merge({
        'field': field,
        'ordering': 'DESC'
    }) %}
    {{ rz_link.root({
            class: 'active ' ~ (column_ordering_class|default('')),
            label: label,
            icon: 'rz-icon-ri--arrow-up-s-fill',
            attributes: {
                href: '?' ~ localOrderingParams|url_encode,
                title: 'sort_desc'|trans,
            }
        })
    }}
{% else %}
    {% set localOrderingParams = orderingParams|merge({
        'field': field,
        'ordering': 'ASC'
    }) %}
        {{
            rz_link.root({
                class: column_ordering_class|default(''),
                label: label,
                content: '&bull;',
                attributes: {
                    href: '?' ~ localOrderingParams|url_encode,
                    title: 'sort_asc'|trans,
                }
            })
        }}
{% endif %}
