import{S as d}from"./sortable.core.esm-Bjnw44Mn.js";class h extends HTMLTableElement{constructor(){super(),this.sortable=null,this.onSortableUpdate=this.onSortableUpdate.bind(this)}get tbody(){return this.querySelector("tbody")}get isSortableEnabled(){return this.getAttribute("data-sortable")==="true"}get sortableHandle(){return this.getAttribute("data-sortable-handle")||".rz-table__handle"}get sortableDragClass(){return this.getAttribute("data-sortable-drag-class")||""}get sortableUrl(){return this.getAttribute("data-sortable-url")}connectedCallback(){!this.isSortableEnabled||!this.tbody||(this.sortable=new d(this.tbody,{animation:150,handle:this.sortableHandle,dragClass:this.sortableDragClass||void 0,onUpdate:this.onSortableUpdate}))}disconnectedCallback(){this.sortable?.destroy(),this.sortable=null}getSortableItemId(r){if(!r)return null;const t=r.getAttribute("data-id");if(!t)return null;const a=parseInt(t,10);return Number.isNaN(a)?null:a}async onSortableUpdate(r){const t=r.item,a=this.sortableUrl;if(!t||!a)return;const n=this.getSortableItemId(t);if(!n)return;const o={csrfToken:window.RozierConfig.ajaxToken,id:n.toString()},i=this.getSortableItemId(t.previousElementSibling),l=this.getSortableItemId(t.nextElementSibling);i!==null?o.prevId=i.toString():l!==null&&(o.nextId=l.toString());try{const e=await fetch(a,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:new URLSearchParams(o)});if(!e.ok)throw e;const s=await e.json();window.dispatchEvent(new CustomEvent("pushToast",{detail:{message:s.responseText,status:s.status}}))}catch(e){let s="An error occurred while updating positions.";e instanceof Response&&(s=(await e.json()).title||""),window.dispatchEvent(new CustomEvent("pushToast",{detail:{message:s,status:"danger"}}))}}}export{h as default};
