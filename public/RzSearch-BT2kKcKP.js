import{l as r,d as a}from"./main-DGA9NN5B.js";import{r as l}from"./rzCard-CW2rd_kK.js";import"./vue-BqDQd3Vv.js";import"./jquery-DmndgEMa.js";import"./rzButton-J_yTZFMr.js";import"./rzBadge-BmGDcOV7.js";const h="searchTerms";class E extends HTMLElement{constructor(){super(),this.value=null,this.searchInput=null,this.dialogElement=null,this.listElement=null,this.spinnerElement=null,this.statusElement=null,this.fetchStatus="idle",this.items=null,this.onInputChange=r.debounce(this.onInputChange.bind(this),300),this.onKeyDown=this.onKeyDown.bind(this),this.closeDialog=this.closeDialog.bind(this)}updateSpinnerVisibility(){this.spinnerElement&&(this.fetchStatus==="pending"?this.spinnerElement.style.display="initial":this.spinnerElement.style.display="none")}getStatusText(){switch(this.fetchStatus){case"idle":return this.getAttribute("idle-text")||"";case"reset":return this.getAttribute("reset-text")||"";case"pending":return this.getAttribute("pending-text")||"";case"results":return this.items?.length===1?this.getAttribute("unique-result-text")||"":this.items?.length&&this.items.length>1?(this.getAttribute("results-text")||"").replace("{n}",String(this.items.length)):"";case"no-results":return this.getAttribute("no-results-text")||"";case"error":return this.getAttribute("error-text")||"";default:return""}}setStatusText(){this.statusElement&&(this.statusElement.textContent=this.getStatusText())}createStatusElements(){let t=this.querySelector("[data-status-wrapper]");const e=this.querySelector("[data-search-body]");!t&&e&&(t=document.createElement("div"),t.setAttribute("data-status-wrapper",""),e.appendChild(t)),t.setAttribute("aria-live","polite"),t.setAttribute("role","status"),t.setAttribute("aria-atomic","true"),this.statusElement=document.createElement("div"),this.statusElement.classList.add("rz-visually-hidden"),this.setStatusText(),t.appendChild(this.statusElement),this.spinnerElement=document.createElement("div"),this.spinnerElement.setAttribute("aria-hidden","true"),this.spinnerElement.classList.add("rz-spinner","rz-spinner--lg"),this.updateSpinnerVisibility(),t.appendChild(this.spinnerElement),this.render()}getItemsElement(){return this.items?.length?this.items.map(t=>{const e=document.createElement("li"),i=t.thumbnail?.url,n=l({tag:t.editItem?"a":"div",title:t.displayable,overtitle:t.classname,image:i?{src:i,width:t.thumbnail?.imageWidth,height:t.thumbnail?.imageHeight,alt:t.thumbnail?.alt||t.displayable}:void 0,attributes:{href:t.editItem}});return e.appendChild(n),e}):[]}render(){if(this.setStatusText(),this.updateSpinnerVisibility(),!this.listElement)return;const t=document.createDocumentFragment();this.getItemsElement()?.forEach(e=>{t.appendChild(e)}),this.listElement.innerHTML="",this.listElement.appendChild(t)}async fetchNodeSources(t){try{this.fetchStatus="pending",this.render();const e=await a.getNodesSourceFromSearch(t);e.length?(this.fetchStatus="results",this.items=e):(this.fetchStatus="no-results",this.items=[])}catch{this.fetchStatus="error",this.items=null}finally{this.render()}}async onInputChange(){const t=this.searchInput?.value||"";this.value=t,!t||t.length<=1?(this.fetchStatus="reset",this.render()):await this.fetchNodeSources(t)}getQueryParamsValue(){return new URLSearchParams(window.location.search).get(h)}connectedCallback(){this.listElement=this.querySelector("[data-results-wrapper]");const t=this.querySelector("[data-search-body]");!this.listElement&&t&&(this.listElement=document.createElement("ul"),this.listElement.setAttribute("data-results-wrapper",""),t.appendChild(this.listElement)),this.dialogElement=this.querySelector('[is="rz-dialog"]');const e=this.getAttribute("initial-value")||this.getQueryParamsValue();if(this.searchInput=this.querySelector('input[type="search"]'),!this.searchInput){console.error("RzSearch: No search input found");return}this.searchInput.addEventListener("input",this.onInputChange),this.dialogElement&&e&&(this.dialogElement.showDialog(),this.searchInput.value=e,this.onInputChange());const i=this.querySelectorAll("[data-prevent-submit]");i?.length&&i.forEach(n=>{n.onsubmit=s=>{s.preventDefault()}}),this.hasAttribute("open-key")&&this.initKeyBindEvent(),this.createStatusElements(),window.addEventListener("pageshowend",this.closeDialog)}disconnectedCallback(){this.hasAttribute("open-key")&&this.disposeKeyBindEvent(),this.searchInput?.removeEventListener("input",this.onInputChange),window.removeEventListener("pageshowend",this.closeDialog)}closeDialog(){this.dialogElement&&this.dialogElement.close()}onKeyDown(t){const e=this.getAttribute("open-key");if(!e)return;e.split("+").map(s=>s.trim().toLowerCase()).every(s=>s==="meta"?t.metaKey||t.ctrlKey:s==="ctrl"?t.ctrlKey:s==="alt"?t.altKey:s==="shift"?t.shiftKey:t.key.toLowerCase()===s)&&this.dialogElement&&(t.preventDefault(),this.dialogElement.showDialog())}initKeyBindEvent(){window.addEventListener("keydown",this.onKeyDown)}disposeKeyBindEvent(){window.removeEventListener("keydown",this.onKeyDown)}}export{E as RzSearch};
