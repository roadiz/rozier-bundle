import{R as e}from"./RoadizElement-XU473doh.js";class r extends e{constructor(){super(),this.entityClass=null,this.entityId=null,this.loading=!0,this.error=null,this.thumbnailData=null,this.intersectionObserver=null,this.hasRequested=!1}connectedCallback(){this.entityClass=this.getAttribute("entity-class"),this.entityId=this.getAttribute("entity-id"),this.loading=!1,this.render(),this.intersectionObserver=new IntersectionObserver(t=>{for(const i of t)i.isIntersecting&&!this.hasRequested&&(this.hasRequested=!0,this.loading=!0,this.render(),this.fetchThumbnail(),this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null))},{root:null,threshold:.1}),this.intersectionObserver.observe(this)}disconnectedCallback(){this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null)}async fetchThumbnail(){if(!this.entityClass||!this.entityId){this.error="Missing entity-class or entity-id attribute",this.loading=!1,this.render();return}try{const t=new URLSearchParams({class:this.entityClass,id:this.entityId}),i=await fetch(`/rz-admin/ajax/entity-thumbnail?${t.toString()}`,{method:"GET",headers:{Accept:"application/json"},credentials:"same-origin"});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);this.thumbnailData=await i.json(),this.loading=!1,this.render()}catch(t){this.error=t instanceof Error?t.message:"Unknown error",this.loading=!1,this.render()}}render(){if(this.classList.toggle("rz-entity-thumbnail--loading",this.loading),this.loading){this.innerHTML='<div class="rz-entity-thumbnail__spinner"></div>';return}if(this.error){this.innerHTML='<div class="rz-entity-thumbnail__placeholder">!</div>',this.setAttribute("title",this.error);return}if(!this.thumbnailData||!this.thumbnailData.url){this.innerHTML='<div class="rz-entity-thumbnail__placeholder"></div>',this.thumbnailData?.title&&this.setAttribute("title",this.thumbnailData.title);return}const t=this.thumbnailData.alt||"",i=this.thumbnailData.title||"";this.innerHTML=`<img
            data-uk-tooltip="{animation:true}"
            class="uk-thumbnail rz-entity-thumbnail__image"
            src="${this.thumbnailData.url}"
            alt="${t}"
            width="${this.thumbnailData.width||""}"
            height="${this.thumbnailData.height||""}"
            loading="lazy"
            />
        `,i&&this.setAttribute("title",i)}}export{r as default};
